{% extends "base.html" %}

{% block title %}Statistiques{% endblock %}

{% block content %}

    <h2>Statistiques Générales</h2>
    <div class="export-csv">
        <button class="btn btn-success" href="{% url 'export_general_stats_as_csv' %}"><span class="glyphicon glyphicon-download"></span>
            Export Data as CSV
        </button>
    </div>
    <table class="table table-condensed table-hover table-bordered table-striped table-stats-vertical">
        <tbody>
            <tr>
                <th class="span8">Dernier appel</th>
                <td class="span4">{{ last_event.received_on }}</td>
            </tr>
            <tr>
                <th>Nombre total de projets</th>
                <td class="important">{{ nb_projects }}</td>
            </tr>
            <tr>
                <th>Nombre total d'appels</th>
                <td class="important">{{ nb_total_events }}</td>
            </tr>
            <tr>
                <th>Nombre total de questionnaires</th>
                <td class="important">{{ nb_survey }}</td>
            </tr>
            <tr>
                <th>Nombre total de numéros uniques</th>
                <td class="important">{{ nb_unique_number }}</td>
            </tr>
            <tr>
                <th>Durée des rappels:</th>
                <td><strong>{{ sum_duration.duration__sum|default:"0" }}</strong> seconde{{ sum_duration.duration__sum|pluralize }}</td>
            </tr>

            <tr>
                <th class="ident">Le plus long</th>
                <td><strong>{{ longest_duration.duration__max }}</strong> seconde{{ longest_duration.duration__max|pluralize }}</td>
            </tr>
            <tr>
                <th class="ident">La moyenne</th>
                <td><strong>{{ average_duration.duration__avg|floatformat }}</strong> seconde{{ average_duration.duration__avg|pluralize }}</td>
            </tr>
            <tr>
                <th class="ident">La minimale</th>
                <td><strong>{{ short_duration.duration__min }}</strong> seconde{{ short_duration.duration__min|pluralize }}</td>
            </tr>
            <tr>
                <th>Total par sexes (Homme/Femme/Inconnu)</th>
                <td>{{ sex_male }} H/ {{ sex_female }} F/ {{ sex_unknown }} Inconnu{{ sex_unknown|pluralize }}</td>
            </tr>
        </tbody>
    </table>

    {% include "stats_per_age.html" %}
    {% include "stats_per_project.html" %}
    {% include "stats_commune_table.html" %}
    {% include "stats_ethinicity_table.html" %}

    <h2>Graphe des appels</h2>
    <div id="container" style="min-width: 400px; height: 400px; margin: 0 auto"></div>

{% endblock %}

{% block extra_js %}graph_event_response_counts("{% url 'event_response_counts' %}");{% endblock %}
